> 此文档记录本系统的开发过程，尽可能详细的去记录开发过程

# 1.概述
本模块主要用于优惠券的发放，且是一个下游模块。
主要的职责为所有优惠券的发放、核销、查询。
预计本系统落地后QPS至少为5w，并且需要管理优惠券完整的生命周期

# 2.技术选型

## 数据库选型

数据库在本系统的作用：运用其ACID特性，支持并发持久化对存储数据

本系统需要进行持久化操作、条件查询、事务处理，故选用通用的结构化存储中间件MySQL

## 缓存选型

缓存在本系统的作用：运用其高频的读写去减轻对数据库对冲击。
但需要注意缓存穿透、击穿、雪崩问题

本系统选用主流的缓存Redis作为缓存中间件

## 消息队列选型

消息队列在本系统的作用：运用消息队列的延迟消息实现券模板/券记录展示过期状态

本系统选用支持延迟消息的RocketMQ

## 分库分表框架选型

分库分表在本系统的作用：能够将I/O压力分散到不同的数据库中，以提升系统整体的并发性能

本系统选用Gorm官方推荐的Sharding插件进行分库分表操作，其原理是在Conn层做了SQL 拦截、AST 解析、分表路由、自增主键填充，并无额外操作。
所以觉得选用此框架

## RPC框架选型

RPC框架在本系统的作用：作为一个下游模块，供上游模块调用

本系统采用字节跳动自研的kitex，也可以换成其他框架。

# 3.系统设计

## 1.技术架构
![技术架构.png](image/技术架构.png)

## 2.功能模块

### 券模板服务
1. 增加券模板功能
2. 删除券模板功能
3. 查询券模板功能
4. 修改券模板功能
5. 获取券模板的有效期
6. 获取券模板的库存消息

### 券记录服务
1. 给指定用户发券
2. 管理券的状态（过期，已使用）
3. 查询券记录

## 3.数据库设计

### 1.数据结构ER图

![数据结构ER图.png](image/数据结构ER图.png)
